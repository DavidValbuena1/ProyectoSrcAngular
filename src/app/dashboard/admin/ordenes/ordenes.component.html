<div class="container-fluid">
  <div class="row mt-5 mb-5">
    <div class="col-md-1"></div>
    <div class="col-md-2">
      <div class="card border border-primary rounded">
        <form>
          <div class="row mt-5 mb-4">
            <h3 class="text-center mb-4">Buscar productos</h3>
            <div class="col-md-1"></div>
            <div class="col-md-10">
              <span class="p-float-label">
                <p-autoComplete id="producto" [suggestions]="filtroproductos" [(ngModel)]="producto"
                  (completeMethod)="filtrarProducto($event)" field="nombre" [dropdown]="true"
                  [ngModelOptions]="{standalone: true}">
                  <ng-template let-c pTemplate="item">
                    <div>{{c.nombre}}</div>
                  </ng-template>
                </p-autoComplete>
                <label for="producto">Seleccione el producto</label>
              </span>
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-3">
              <button pButton type="submit" (click)="llenarDatosFormulario(producto)" class="mt-5">Buscar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="col-md-1"></div>
    <div class="col-md-4">
      <div class="card border border-success rounded ">

        <form [formGroup]="formCarrito">
          <div class="row mb-2 mt-3">
            <h3 class="text-center mb-3">Rellenar datos para la orden</h3>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input id="nombre" pInputText [(ngModel)]="nombreproducto" formControlName="name">
                <label for="nombre">Nombre</label>
              </span>
              <div *ngIf="this.envio">
                <span class="text-danger" *ngIf="this.formCarrito.get('name')?.errors?.['required']"><Strong>
                    El nombre no puede quedar vacío
                  </Strong>
                </span>
              </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input id="talla" pInputText [(ngModel)]="talla" formControlName="talla">
                <label for="talla">Talla</label>
              </span>
              <div *ngIf="this.envio">
                <span class="text-danger" *ngIf="this.formCarrito.get('talla')?.errors?.['required']"><Strong>
                    La talla no puede quedar vacia
                  </Strong>
                </span>
              </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input pInputText type="number" id="preciounidad" [min]="0" [(ngModel)]="precioUnidad"
                  formControlName="preciounidad">
                <label for="preciounidad">Precio por Unidad</label>
              </span>
              <div *ngIf="this.envio">
                <span class="text-danger" *ngIf="this.formCarrito.get('preciounidad')?.errors?.['required']"><Strong>
                    El precio por unidad no puede quedar vacio
                  </Strong>
                </span>
              </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input pInputText type="number" id="cantidad" [(ngModel)]="cantidadproducto" [min]="0"
                  formControlName="cantidad">
                <label for="cantidad">Cantidad</label>
              </span>
              <div *ngIf="this.envio">
                <span class="text-danger" *ngIf="this.formCarrito.get('cantidad')?.errors?.['required']"><Strong>
                    La cantidad no puede quedar vacio
                  </Strong>
                </span>
              </div>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input pInputText id="observaciones" [(ngModel)]="observaciones" [ngModelOptions]="{standalone: true}">
                <label for="observaciones">Observaciones</label>
              </span>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-5 mb-4">
              <span class="p-float-label">
                <input pInputText type="number" id="descuento" [(ngModel)]="descuento" [min]="0"
                  formControlName="descuento">
                <label for="descuento">Descuento</label>
              </span>
              <div *ngIf="this.envio">
                <span class="text-danger" *ngIf="this.formCarrito.get('descuento')?.errors?.['max']"><Strong>
                    El descuento no puede ser mayor a 100%
                  </Strong>
                </span>
              </div>
            </div>
          </div>
          <div class="row d-flex justify-content-center mb-3">
            <div class="col-md-2">
              <button pButton (click)="agregarAlCarrito()">Agregar</button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <div class="col-md-1"></div>
    <div class="col-md-2">
      <div class="card border rounded border-primary">
        <div class="row mt-5">
          <h3 class="text-center mb-4">Enviar Orden</h3>
          <div class="col-md-12 d-flex justify-content-center mb-3">
            <span class="p-float-label">
              <p-autoComplete id="proveedor" [(ngModel)]="proveedor" [suggestions]="filtroproveedor"
                (completeMethod)="filtrarProveedor($event)" field="nombre" [dropdown]="true"
                [ngModelOptions]="{standalone: true}">
                <ng-template let-c pTemplate="item">
                  <div>{{c.nombre}}</div>
                </ng-template>
              </p-autoComplete>
              <label for="proveedor">Seleccione el proveedor</label>
            </span>
          </div>
          <div class="col-md-12 d-flex justify-content-center mb-5">
            <button pButton (click)="GenerarOrden()">Generar orden</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-1"></div>
    <div class="col-md-10">
      <p-table [value]="carrito" [paginator]="true" [rows]="5" [showCurrentPageReport]="true"
        currentPageReportTemplate="Viendo {first} de {last} registros, {totalRecords} registros en total"
        [rowsPerPageOptions]="[5,10,25,50]" [resizableColumns]="true" columnResizeMode="expand"
        styleClass="p-datatable-gridlines p-datatable-sm" responsiveLayout="scroll">
        <ng-template pTemplate="header">
          <tr>
            <th>#<p-columnFilter type="text" field="numeroproducto" display="menu"></p-columnFilter>
            </th>
            <th>Nombre<p-columnFilter type="text" field="nombreproducto" display="menu"></p-columnFilter>
            </th>
            <th>Talla<p-columnFilter type="text" field="talla" display="menu"></p-columnFilter>
            </th>
            <th>Cantidad<p-columnFilter type="text" field="cantidadproducto" display="menu"></p-columnFilter>
            </th>
            <th>Precio por unidad<p-columnFilter type="text" field="preciounidad" display="menu"></p-columnFilter>
            </th>
            <th>Descuento<p-columnFilter type="text" field="descuento" display="menu"></p-columnFilter>
            </th>
            <th>Precio total<p-columnFilter type="text" field="preciototal" display="menu"></p-columnFilter>
            </th>
            <th>Observaciones<p-columnFilter type="text" field="observaciones" display="menu"></p-columnFilter>
            </th>
            <th></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-detalle>
          <tr>
            <td>{{detalle.numeroproducto}}</td>
            <td>{{detalle.nombreproducto}}</td>
            <td>{{detalle.talla}}</td>
            <td>{{detalle.cantidadproducto}}</td>
            <td>${{detalle.preciounidad}}</td>
            <td>{{detalle.descuento}}%</td>
            <td>${{detalle.preciototal}}</td>
            <td>{{detalle.observaciones}}</td>
            <td><button pButton (click)="buscarProductoCarrito(detalle.numeroproducto)">Editar</button></td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <div class="row">
    <div class="col-md-9"></div>
    <div class="col-md-2">
      <h3>
        Suma total: ${{precioTotal}}
      </h3>
    </div>
  </div>
</div>

<div class="container-fluid">
  <p-dialog [(visible)]="modalEdicionCarrito" [modal]="true" [draggable]="false" [closable]="false"
    [breakpoints]="{'960px': '75vw'}">
    <div class="row">
      <div class="col-md-12 d-flex justify-content-end">
        <button (click)="cerrarModalCarrito()" class="btn btn-outline-dark">X</button>
      </div>
    </div>
    <form [formGroup]="formEdicionCarrito">
      <div class="row mb-2 mt-3">
        <h3 class="text-center mb-3">Actualizar datos del producto #{{numeroproducto}} de la orden</h3>
        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <p-autoComplete id="producto" [suggestions]="filtroproductos" [(ngModel)]="producto"
                  (completeMethod)="filtrarProducto($event)" field="nombre" [dropdown]="true"
                  formControlName="nombre">
                  <ng-template let-c pTemplate="item">
                    <div>{{c.nombre}}</div>
                  </ng-template>
                </p-autoComplete>
                <label for="producto">Seleccione el producto</label>
          </span>
          <div *ngIf="this.envio">
            <span class="text-danger" *ngIf="this.formEdicionCarrito.get('nombre')?.errors?.['required']"><Strong>
                El nombre no puede quedar vacío
              </Strong>
            </span>
          </div>
        </div>

        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <input id="talla" pInputText [(ngModel)]="talla" formControlName="talla">
            <label for="talla">Talla</label>
          </span>
          <div *ngIf="this.envio">
            <span class="text-danger" *ngIf="this.formEdicionCarrito.get('talla')?.errors?.['required']"><Strong>
                La talla no puede quedar vacia
              </Strong>
            </span>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <input pInputText type="number" id="preciounidad" [min]="0" [(ngModel)]="precioUnidad"
              formControlName="preciounidad">
            <label for="preciounidad">Precio por Unidad</label>
          </span>
          <div *ngIf="this.envio">
            <span class="text-danger" *ngIf="this.formEdicionCarrito.get('preciounidad')?.errors?.['required']"><Strong>
                El precio por unidad no puede quedar vacio
              </Strong>
            </span>
          </div>
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <input pInputText type="number" id="cantidad" [(ngModel)]="cantidadproducto" [min]="0"
              formControlName="cantidad">
            <label for="cantidad">Cantidad</label>
          </span>
          <div *ngIf="this.envio">
            <span class="text-danger" *ngIf="this.formEdicionCarrito.get('cantidad')?.errors?.['required']"><Strong>
                La cantidad no puede quedar vacio
              </Strong>
            </span>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <input pInputText id="observaciones" [(ngModel)]="observaciones" [ngModelOptions]="{standalone: true}">
            <label for="observaciones">Observaciones</label>
          </span>
        </div>
        <div class="col-md-1"></div>
        <div class="col-md-5 mb-4">
          <span class="p-float-label">
            <input pInputText type="number" id="descuento" [(ngModel)]="descuento" [min]="0"
              formControlName="descuento">
            <label for="descuento">Descuento</label>
          </span>
          <div *ngIf="this.envio">
            <span class="text-danger" *ngIf="this.formEdicionCarrito.get('descuento')?.errors?.['max']"><Strong>
                El descuento no puede ser mayor a 100%
              </Strong>
            </span>
          </div>
        </div>
      </div>
      <div class="row d-flex justify-content-center mb-3">
        <div class="col-md-2">
          <button pButton (click)="actualizarCarrito()">Actualizar</button>
        </div>
      </div>
    </form>
  </p-dialog>
</div>